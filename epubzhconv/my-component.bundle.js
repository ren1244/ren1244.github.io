!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MyComponent={})}(this,(function(e){"use strict";function t(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&l.firstChild?l.insertBefore(i,l.firstChild):l.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}t(".ren1244-ui-file-uploader{\n    width:320px;\n    height:240px;\n    border:1px solid gray;\n    border-radius:5px;\n    display:inline-flex;\n    justify-content:center;\n    align-items:center;\n    background-color:#fff;\n}\n.ren1244-ui-file-uploader>div{\n    text-align:center;\n    display:inline-block;\n}\n.ren1244-ui-file-uploader span{\n    padding:5px 10px;\n    border:1px solid gray;\n    background-color:lightgray;\n    border-radius:5px;\n    color:black;\n    cursor:pointer;\n}\n.ren1244-ui-file-uploader p{\n    color:black;\n}");t(".loca-selector {\n    display: inline-block;\n}");const n="loca-selector";t(".output-table {\n    border-collapse: collapse;\n}\n.output-table th, td{\n    padding: 0.2em 0.4em;\n    border: 1px solid black;\n}\n.output-table th:nth-child(1), .output-table td:nth-child(1) {\n    width: 400px;\n}\n.output-table th:nth-child(2), .output-table td:nth-child(2) {\n    width: 400px;\n}\n.output-table p{\n    margin: 0px;\n    padding: 0px;\n    line-height: 150%;\n}\n.output-table-dl-all {\n    margin-top: 10px;\n    text-align: right;\n}\n");t(".output-tr td:nth-child(2) {\n    border-right: none;\n}\n.output-tr td:nth-child(3) {\n    border-left: none;\n}\n.output-tr-info {\n    color: gray;\n}");class l{constructor(e,t,n){let l=document.createElement("template");l.innerHTML='<tr class="output-tr">\n    <td>\n        <p class="output-tr-filename"></p>\n        <p class="output-tr-info"></p>\n    </td>\n    <td>\n        <span>處理中</span>\n        <a style="display: none;"></a>\n    </td>\n    <td>\n        <button style="display: none;">x</button>\n    </td>\n</tr>',this.trEle=l.content.querySelector(".output-tr"),e.appendChild(l.content),this.filename=t,this.trEle.querySelector(".output-tr-filename").textContent=t,this.trEle.querySelector(".output-tr-info").textContent=this.getInfoStr(t,n),this.msg=this.trEle.children[1].querySelector("span"),this.aTag=this.trEle.children[1].querySelector("a"),this.closeBtn=this.trEle.children[2].querySelector("button"),this.closeBtn.addEventListener("click",this.destory.bind(this)),this.url=!1,this.finalData=!1}destory(){this.url&&URL.revokeObjectURL(this.url),this.trEle.parentElement.dispatchEvent(new CustomEvent("delete-output-tr",{bubbles:!0,detail:{component:this}})),this.trEle.parentElement.removeChild(this.trEle)}finish(e){this._updateUrl(e),this.closeBtn.removeAttribute("style"),this.msg.setAttribute("style","display: none"),this.aTag.removeAttribute("style"),this.aTag.href=this.url,this.aTag.download=this.filename,this.aTag.textContent=this.filename}log(e){this.msg.textContent=e}error(e){this.closeBtn.removeAttribute("style"),this.msg.textContent=e}_updateUrl(e){this.url&&URL.revokeObjectURL(this.url),this.finalData=e,e=new Blob([e]),this.url=URL.createObjectURL(e)}getInfoStr(e,t){let n=e.lastIndexOf(".");return"epub"===(n>=0?e.slice(n+1):null)?`(epub ; ${t.loca.from} => ${t.loca.to})`:`(${t.encoding} => utf-8 ; ${t.loca.from} => ${t.loca.to})`}}e.FileUploader=class{constructor(e){let t=document.createElement("template");t.innerHTML='<div class="ren1244-ui-file-uploader">\n    <div>\n        <p>拖曳或選擇檔案</p>\n        <span>選擇</span>\n    </div>\n</div>',this.warpEle=t.content.querySelector(".ren1244-ui-file-uploader"),e.appendChild(t.content),this.warpEle.addEventListener("dragover",this._stopHandler.bind(this),!0),this.warpEle.addEventListener("dragleave",this._stopHandler.bind(this),!0),this.warpEle.addEventListener("drop",this._dropHandler.bind(this),!0),this.warpEle.addEventListener("click",this._clickHandler.bind(this)),this.uploderElement=document.createElement("input"),this.uploderElement.setAttribute("type","file"),this.uploderElement.multiple=!0,this.uploderElement.addEventListener("change",(e=>{this._sendFileUploadEvent(e.target.files)}))}_stopHandler(e){e.preventDefault(),e.stopPropagation()}_dropHandler(e){e.preventDefault(),e.stopPropagation(),this._sendFileUploadEvent(e.dataTransfer.files)}_clickHandler(e){e.preventDefault(),e.stopPropagation(),this.uploderElement.click()}_sendFileUploadEvent(e){let t=new CustomEvent("upload-files",{bubbles:!0,detail:{files:e,component:this}});this.warpEle.dispatchEvent(t)}},e.LocaSelector=class{constructor(e){let t,l=document.createElement("template");l.innerHTML='<h3>字詞轉換</h3>\n<div class="loca-selector">\n    從\n    <select class="loca-selector-from">\n        <option value="cn">簡體</option>\n        <option value="tw">繁體(臺灣)</option>\n        <option value="twp">繁體(臺灣+詞彙)</option>\n        <option value="hk">繁體(香港)</option>\n        <option value="jp">日本新字體</option>\n    </select>\n    到\n    <select class="loca-selector-to">\n        <option value="cn">簡體</option>\n        <option value="tw">繁體(臺灣)</option>\n        <option value="twp">繁體(臺灣+詞彙)</option>\n        <option value="hk">繁體(香港)</option>\n        <option value="jp">日本新字體</option>\n    </select>\n</div>\n<h3>編碼轉換</h3>\n<div>\n    從\n    <select class="loca-selector-enc">\n        <option value="utf-8">utf-8</option>\n        <option value="big5">big5</option>\n        <option value="gb18030">gb18030</option>\n        <option value="shift-jis">shift-jis</option>\n    </select>\n    到\n    <select disabled="disabled">\n        <option value="utf-8">utf-8</option>\n    </select>\n</div>\n<p>這個選項用來指定文字檔以何種編碼讀取，輸出都會轉為 utf-8</p>',this.warpEle=l.content.querySelector(".loca-selector"),this.encEle=l.content.querySelector(".loca-selector-enc"),e.appendChild(l.content),this.fromEle=this.warpEle.querySelector(".loca-selector-from"),this.toEle=this.warpEle.querySelector(".loca-selector-to");try{if(t=JSON.parse(localStorage.getItem(n)),!(t instanceof Object))throw"not object"}catch(e){t={from:"cn",to:"tw",encoding:"utf-8"}}this.setSelectValue(this.fromEle,t.from),this.setSelectValue(this.toEle,t.to),this.setSelectValue(this.encEle,t.encoding),this.fromEle.addEventListener("change",this.saveToLocalStorage.bind(this)),this.toEle.addEventListener("change",this.saveToLocalStorage.bind(this)),this.encEle.addEventListener("change",this.saveToLocalStorage.bind(this))}setSelectValue(e,t){let n,l=e.options;for(n=l.length-1;n>=0&&l[n].value!==t;--n);n>=0&&(e.selectedIndex=n)}saveToLocalStorage(e){localStorage.setItem(n,JSON.stringify(this.getData()))}getData(){return{from:this.fromEle.value,to:this.toEle.value,encoding:this.encEle.value}}},e.OutputTable=class{constructor(e){let t=document.createElement("template");t.innerHTML='<table class="output-table">\n    <thead>\n        <th>檔案</th>\n        <th colspan="2">輸出</th>\n    </thead>\n    <tbody></tbody>\n</table>\n<div class="output-table-dl-all" style="display: none;">\n    <a>下載全部</a>\n</div>\n',this.tableEle=t.content.querySelector(".output-table"),this.dlAllEle=t.content.querySelector(".output-table-dl-all"),this.tableEle.style.display="none",e.appendChild(t.content),this.trObjects=new Map,this.filenames={},this.url=!1,this.tableEle.addEventListener("delete-output-tr",this.onDeleteTr.bind(this))}push(e,t){if(this.filenames[e])return!1;this.tableEle.removeAttribute("style");let n=new l(this.tableEle.tBodies[0],e,t);return this.filenames[e]=n,this.trObjects.set(n,e),!0}onDeleteTr(e){let t=e.detail.component,n=this.trObjects.get(t);this.trObjects.delete(t),delete this.filenames[n],Object.keys(this.filenames).length<=0&&(this.tableEle.style.display="none"),this.hideDownloadAll(),this._sendDoneEventIfComplete()}finish(e,t){if(!this.filenames[e])return;this.filenames[e].finish(t),this._sendDoneEventIfComplete()}log(e,t){if(!this.filenames[e])return;this.filenames[e].log(t)}error(e,t){if(!this.filenames[e])return;this.filenames[e].error(t)}_sendDoneEventIfComplete(){let e={},t=0;for(let n in this.filenames){let l=this.filenames[n];if(!l.finalData)return;e[n]=l.finalData,++t}t>0&&this.tableEle.dispatchEvent(new CustomEvent("output-table-complete",{bubbles:!0,detail:e}))}showDownloadAll(e,t){this.url&&URL.revokeObjectURL(this.url),this.url=URL.createObjectURL(new Blob([t])),this.dlAllEle.removeAttribute("style");let n=this.dlAllEle.querySelector("a");n.href=this.url,n.download=e}hideDownloadAll(){this.dlAllEle.setAttribute("style","display: none")}},Object.defineProperty(e,"__esModule",{value:!0})}));
